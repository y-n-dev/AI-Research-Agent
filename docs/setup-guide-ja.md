# 🤖 AI調査エージェント - 完全セットアップガイド

> **自分で自分を改良する革新的なAI調査アシスタント**

このガイドでは、AI調査エージェントを0から完全にセットアップする手順を、初心者の方でも分かりやすく説明します。

## 📋 事前準備

### 必要なサービス一覧
| サービス | 料金 | 用途 | 必須度 |
|---------|------|------|--------|
| **Discord Bot** | 無料 | ユーザーインターフェイス | ⭐⭐⭐ |
| **n8n Self-hosted** | 無料 | ワークフロー自動化 | ⭐⭐⭐ |
| **Google Sheets** | 無料 | データ管理 | ⭐⭐⭐ |
| **Google Custom Search API** | 無料枠あり* | Web検索 | ⭐⭐⭐ |
| **Claude API** | 有料** | AI分析エンジン | ⭐⭐⭐ |
| **Notion** | 無料 | レポート保存 | ⭐⭐⭐ |

*1日100回まで無料、その後1000回あたり$5  
**月$20〜（使用量による）

### 所要時間
- **初回セットアップ**: 約2-3時間
- **テスト・調整**: 約1時間
- **合計**: 約3-4時間

---

## 🤖 Step 1: Discord Botの作成

### なぜDiscord Botが必要なの？
Discord BotはAI調査エージェントの「受付窓口」です。あなたがDiscordに調査依頼を投稿すると、Botがそれを受け取って自動で調査を開始します。

### 完成イメージ
```
あなた: 「グラボ おすすめ」とDiscordに投稿
        ↓
    【最大15分待機】
        ↓
AI Bot: 「📝 グラボ おすすめの調査を開始します！」
        ↓
    【Web検索 + AI分析】
        ↓  
AI Bot: 「✅ 調査完了！結果をNotionに保存しました [リンク]」
```

### おすすめの使い方
✅ **こんな時に便利**：
- 寝る前に明日の資料用の調査を依頼
- 外出中に気になったことを投稿→帰宅時に結果確認
- 複数のトピックをまとめて投稿（古い順から処理）

❌ **こんな用途には不向き**：
- 今すぐ答えが欲しい緊急調査
- ChatGPTのようなリアルタイム対話

---

### 1.1 Discord Developer Portalでアプリケーション作成

**所要時間**: 約10分

1. **Discord Developer Portalにアクセス**
   - [https://discord.com/developers/applications](https://discord.com/developers/applications)
   - Discordアカウントでログイン

2. **新しいアプリケーションを作成**
   - 右上の「New Application」をクリック
   - アプリケーション名を入力（例：`AI調査エージェント`）
   - 「Create」をクリック

💡 **ヒント**: アプリケーション名は後で変更できるので、分かりやすい名前にしておきましょう

### 1.2 Botの作成と設定

1. **Botを作成**
   - 左メニューから「Bot」を選択
   - 「Add Bot」をクリック
   - 確認画面で「Yes, do it!」をクリック

2. **重要な設定を有効化**
   
   **なぜこの設定が必要？**: BotがDiscordメッセージを読み取るために必要です
   
   - ✅ `MESSAGE CONTENT INTENT`
   - ✅ `SERVER MEMBERS INTENT`（推奨）

⚠️ **注意**: この設定を忘れると、Botがメッセージを認識できません！

### 1.3 Botトークンの取得

1. **トークンをコピー**
   - 「Token」セクションの「Copy」ボタンをクリック
   - メモ帳などに安全に保存

```text
🔐 重要：このトークンは絶対に他人に見せないでください！
💾 保存場所：デスクトップの「AI調査エージェント設定.txt」などに保存推奨
```

### 1.4 Botをサーバーに招待

1. **招待URLの生成**
   - 左メニューから「OAuth2」→「URL Generator」を選択
   - **Scopes**で`bot`にチェック
   - **Bot Permissions**で以下を選択：
     - ✅ `Send Messages`（調査結果の通知用）
     - ✅ `Read Message History`（過去メッセージの確認用）
     - ✅ `Add Reactions`（受付確認用・オプション）

2. **Botを招待**
   - 生成されたURLをコピー
   - 新しいタブでURLを開く
   - 招待先サーバーを選択
   - 「認証」をクリック

✅ **確認方法**: サーバーのメンバー一覧にBotが表示されればOK！

### 1.5 Discord チャンネルの準備

**推奨チャンネル構成**:
- 📝 `ai調査依頼` - 調査したいトピックを投稿
- 📋 `調査結果` - 開始・完了通知
- 💭 `aiちゃんのつぶやき` - 退屈メッセージ・学習報告

💡 **ヒント**: チャンネル名は後で変更できるので、まずは作成しておきましょう

---

## 📊 Step 2: Google Sheetsの準備

### なぜGoogle Sheetsが必要なの？
Google SheetsはAI調査エージェントの「データベース兼設定ファイル」です。Discord IDやAPI キーなどの設定情報、処理済みメッセージの記録、AIの学習データなど、すべての重要情報を管理します。

### 完成イメージ
```
config シート        → 各種API設定（Discord ID、APIキーなど）
processed_messages   → 処理済み調査依頼の記録（重複防止用）
research_history     → 過去の調査結果（AI学習用データ）
prompt_management    → AIプロンプトのバージョン管理
```

**所要時間**: 約20分

---

### 2.1 スプレッドシートの作成

1. **Google Sheetsにアクセス**
   - [https://sheets.google.com](https://sheets.google.com)
   - Googleアカウントでログイン

2. **新しいスプレッドシートを作成**
   - 左上の「空白」をクリック
   - 新しいシートが開きます

3. **分かりやすい名前に変更**
   - 左上の「無題のスプレッドシート」をクリック
   - 「AI調査エージェント状態管理」に変更
   - Enterキーで確定

💡 **ヒント**: この名前はあとでファイルを探すときに重要です

### 2.2 4つのシートを作成

#### **Step 2.2.1: 1番目のシートを「config」に変更**

1. **シート名の変更**
   - 画面下部の「シート1」を右クリック
   - 「名前を変更」を選択
   - 「config」と入力してEnter

2. **config シートの内容を入力**

A列（key）とB列（value）に以下を入力：

| A列（key） | B列（value） |
|-----------|-------------|
| discord_server_id | [あとで入力] |
| discord_research_channel_id | [あとで入力] |
| discord_result_channel_id | [あとで入力] |
| discord_chat_channel_id | [あとで入力] |
| google_search_api_key | [あとで入力] |
| google_search_engine_id | [あとで入力] |
| notion_database_id | [あとで入力] |
| last_message_id |  |
| boredom_level | 0 |
| learning_count | 0 |

💡 **コピペ用**: [あとで入力] は後のステップで実際の値に置き換えます

#### **Step 2.2.2: 2番目のシート「processed_messages」を作成**

1. **新しいシートを追加**
   - 画面下部の「+」ボタンをクリック
   - 新しいシートが作成されます

2. **シート名を変更**
   - 「シート2」を右クリック→「名前を変更」
   - 「processed_messages」と入力

3. **ヘッダーを入力**

| A列 | B列 | C列 | D列 |
|-----|-----|-----|-----|
| message_id | content | processed_date | status |

#### **Step 2.2.3: 3番目のシート「research_history」を作成**

1. **新しいシートを追加** (「+」ボタン)
2. **シート名変更** (「research_history」)
3. **ヘッダーを入力**

| A列 | B列 | C列 | D列 | E列 |
|-----|-----|-----|-----|-----|
| research_date | original_content | research_result | notion_page_url | status |

#### **Step 2.2.4: 4番目のシート「prompt_management」を作成**

1. **新しいシートを追加** (「+」ボタン)
2. **シート名変更** (「prompt_management」)
3. **ヘッダーを入力**

| A列 | B列 | C列 | D列 | E列 | F列 | G列 |
|-----|-----|-----|-----|-----|-----|-----|
| prompt_name | current_prompt_text | version | update_date | improvement_reason | is_active | character_limit |

✅ **確認**: 画面下部に4つのシートタブが表示されていればOK！

### 2.3 スプレッドシートIDの確認（重要！）

**このIDは後で n8n の設定で使います**

1. **URLを確認**
   ```
   https://docs.google.com/spreadsheets/d/【ここがスプレッドシートID】/edit
   ```

2. **IDをコピー**
   - URLの「/d/」と「/edit」の間の文字列をコピー
   - 例: `1tE6eK5zy48iBCCxu9bW0depV49eIuWu5-DLfHZsM2Os`

3. **メモ帳に保存**
   ```text
   スプレッドシートID: 1tE6eK5zy48iBCCxu9bW0depV49eIuWu5-DLfHZsM2Os
   ```

💡 **ヒント**: このIDは約44文字の英数字です

### 2.4 Google Cloud Console でのAPI設定

**なぜこの設定が必要？**: n8nがGoogle Sheetsにアクセスするために必要な「鍵」を作成します

#### **Step 2.4.1: Google Cloud プロジェクトの作成**

1. **Google Cloud Console にアクセス**
   - [https://console.cloud.google.com](https://console.cloud.google.com)
   - Google アカウントでログイン

2. **新しいプロジェクトを作成**
   - 画面上部のプロジェクト選択メニューをクリック
   - 「新しいプロジェクト」をクリック
   - プロジェクト名: `ai-research-agent`（任意）
   - 「作成」をクリック

💡 **ヒント**: プロジェクト作成には1-2分かかる場合があります

#### **Step 2.4.2: Google Sheets API の有効化**

1. **APIライブラリにアクセス**
   - 左メニューから「APIs & Services」→「ライブラリ」
   - 検索ボックスに「sheets」と入力
   - 「Google Sheets API」をクリック

2. **API を有効化**
   - 「有効にする」ボタンをクリック
   - 有効化完了まで少し待ちます

#### **Step 2.4.3: Service Account（サービスアカウント）の作成**

**Service Account とは？**: 人間ではなく、アプリケーション（n8n）がGoogle サービスにアクセスするための専用アカウントです

1. **認証情報画面にアクセス**
   - 左メニューから「APIs & Services」→「認証情報」
   - 「認証情報を作成」→「サービスアカウント」をクリック

2. **サービスアカウントの詳細を入力**
   - サービスアカウント名: `AI-Research-Agent`
   - サービスアカウントID: 自動生成（変更不要）
   - 説明: `AI調査エージェント用アカウント`（任意）
   - 「作成して続行」をクリック

3. **ロール設定（スキップ）**
   - 「このサービスアカウントにプロジェクトへのアクセス権を付与」は空欄のまま
   - 「続行」をクリック

4. **ユーザーアクセス（スキップ）**
   - そのまま「完了」をクリック

#### **Step 2.4.4: JSON キーファイルのダウンロード**

1. **作成したサービスアカウントをクリック**
   - 認証情報一覧から先ほど作成したサービスアカウントを選択

2. **キーを作成**
   - 「キー」タブをクリック
   - 「キーを追加」→「新しいキーを作成」
   - 「JSON」を選択
   - 「作成」をクリック

3. **JSONファイルを安全に保存**
   - 自動でダウンロードが開始されます
   - デスクトップなど、分かりやすい場所に保存
   - ファイル名例: `ai-research-agent-xxxxx.json`

⚠️ **重要**: このJSONファイルは絶対に他人に見せないでください！

### 2.5 スプレッドシートの共有設定

**最重要ステップ**: この設定を忘れると、n8nがスプレッドシートにアクセスできません！

1. **JSONファイルからメールアドレスを確認**
   - ダウンロードしたJSONファイルをメモ帳で開く
   - `"client_email"` の値をコピー
   - 例: `ai-research-agent@xxxxx.iam.gserviceaccount.com`

2. **スプレッドシートを共有**
   - Google Sheets に戻る
   - 右上の「共有」ボタンをクリック
   - 先ほどコピーしたメールアドレスを入力
   - 権限を「編集者」に設定
   - 「送信」をクリック（通知はスキップでOK）

✅ **確認方法**: 共有設定に Service Account のメールアドレスが表示されていればOK！

---

💾 **ここまでの成果物を確認**:
- ✅ 4つのシートが作成されたスプレッドシート
- ✅ スプレッドシートID（44文字の英数字）
- ✅ Service Account のJSONファイル
- ✅ スプレッドシートの共有設定完了

---

## 🔍 Step 3: Google Custom Search APIの設定

### なぜGoogle Custom Search APIが必要なの？
Google Custom Search APIは、AI調査エージェントの「情報収集エンジン」です。ユーザーからの調査依頼に対して、最新のWeb情報を検索・取得し、AIが分析するためのデータソースとして活用します。

### 完成イメージ
```
調査依頼「グラボ おすすめ」
        ↓
Google Custom Search API でWeb検索
        ↓
最新の記事・レビュー・価格情報を取得
        ↓
Claude AI が検索結果を分析
        ↓
総合的な調査レポートを生成
```

### 💰 料金について（重要！）

| 使用量 | 料金 | 想定される利用状況 |
|--------|------|------------------|
| **1〜100回/日** | **完全無料** | 1日6-7回の調査（月間約150-200回） |
| **101〜1000回/日** | **$5/1000回** | 1日10-30回の調査（月$10-15程度） |

**実際の使用量予測**:
- 15分間隔で動作 → 1日最大96回チェック
- でも調査実行は依頼があった時のみ
- **通常利用なら無料枠内で十分！** 👍

**所要時間**: 約15分

---

### 3.1 Google Cloud Console での API 有効化

**前提**: Step 2で作成したGoogle Cloud プロジェクトを使用します

1. **Google Cloud Console にアクセス**
   - [https://console.cloud.google.com](https://console.cloud.google.com)
   - Step 2で作成したプロジェクト（`ai-research-agent`）が選択されていることを確認

2. **Custom Search API を有効化**
   - 左メニューから「APIs & Services」→「ライブラリ」
   - 検索ボックスに「custom search」と入力
   - 「Custom Search API」をクリック
   - 「有効にする」ボタンをクリック

💡 **ヒント**: 有効化には1-2分かかる場合があります

### 3.2 API キーの作成

1. **認証情報画面にアクセス**
   - 左メニューから「APIs & Services」→「認証情報」
   - 「認証情報を作成」→「APIキー」をクリック

2. **APIキーをコピー**
   - 作成されたAPIキーをコピー
   
   ```
   APIキー例: AIzaSyDxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```

3. **APIキーを制限（セキュリティ向上・推奨）**
   - 「APIキーを制限」をクリック
   - 「API の制限」→「キーを制限」
   - 「Custom Search API」のみにチェック
   - 「保存」をクリック

⚠️ **重要**: APIキーは絶対に他人に見せないでください！

### 3.3 Custom Search Engine（検索エンジン）の作成

**Custom Search Engine とは？**: Google検索を特定の条件で実行するための設定です

1. **Google Custom Search にアクセス**
   - [https://cse.google.com/cse/](https://cse.google.com/cse/)
   - 同じGoogleアカウントでログイン

2. **新しい検索エンジンを作成**
   - 「開始する」または「新しい検索エンジン」をクリック
   - 検索する site（サイト）: `*`と入力
   - 「作成」をクリック

💡 **なぜ `*` なのか？**: 全てのWebサイトを検索対象にするためです（最も汎用的）

3. **検索エンジンの設定調整**
   - 作成後の設定画面で「設定」タブをクリック
   - 「ウェブ全体を検索」: **ON** に設定
   - これで全インターネットが検索対象になります

### 3.4 検索エンジンIDの取得

1. **検索エンジンIDをコピー**
   - 「設定」タブの「基本」セクション
   - 「検索エンジンID」をコピー
   
   ```
   検索エンジンID例: a1b2c3d4e5f6g7h8i9j0
   ```

### 3.5 動作テスト（重要！）

**実際にAPIが動作するかテストしましょう**

1. **テスト用URLにアクセス**
   ```
   https://www.googleapis.com/customsearch/v1?key=[APIキー]&cx=[検索エンジンID]&q=テスト
   ```
   
   **実際の例**:
   ```
   https://www.googleapis.com/customsearch/v1?key=AIzaSyDxxxxxxx&cx=a1b2c3d4e5f6g7h8i9j0&q=テスト
   ```

2. **期待される結果**
   - JSON形式の検索結果が表示される
   - `"items"` 配列に検索結果が含まれている

3. **エラーが出た場合**
   ```json
   // APIキー間違いの場合
   {"error": {"code": 403, "message": "The request is missing a valid API key."}}
   
   // 検索エンジンID間違いの場合  
   {"error": {"code": 400, "message": "Invalid Value"}}
   ```

✅ **テスト成功の確認**: JSON データが表示され、検索結果が含まれていればOK！

### 3.6 Google Sheets の config 更新

**Step 2 で作成したスプレッドシートに API 情報を記録**

1. **config シートを開く**
   - Step 2で作成した「AI調査エージェント状態管理」スプレッドシート
   - 「config」シートを選択

2. **API情報を入力**
   
   | key | value |
   |-----|-------|
   | google_search_api_key | AIzaSyDxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |
   | google_search_engine_id | a1b2c3d4e5f6g7h8i9j0 |

💾 **保存**: 入力後、自動で保存されます

### 3.7 使用量の監視設定（推奨）

**予期しない料金発生を防ぐため**

1. **Google Cloud Console で使用量確認**
   - 「APIs & Services」→「ダッシュボード」
   - 「Custom Search API」をクリック
   - 使用量グラフで日次使用量を確認可能

2. **アラート設定（オプション）**
   - 「お支払い」→「予算とアラート」
   - 月$5の予算アラートを設定
   - 無料枠を超えそうになったら通知

💡 **節約のコツ**:
- n8nの実行間隔を30分に変更（月1440回に削減）
- テスト期間は短めに設定
- 不要な調査依頼は避ける

---

💾 **ここまでの成果物を確認**:
- ✅ Custom Search API が有効化されている
- ✅ APIキー（約40文字）を取得・制限設定済み
- ✅ 検索エンジンID（約20文字）を取得
- ✅ 動作テストで正常にJSON結果が取得できる
- ✅ Google Sheets の config に API情報を記録済み

**次のステップ**: これでWeb検索の準備が整いました！次はNotionでレポート保存先を作成します 📝

---

## 📝 Step 4: Notionの設定

### なぜNotionが必要なの？
NotionはAI調査エージェントの「レポート保存庫」です。AI が作成した調査結果を見やすい形で保存し、後から簡単に確認・検索できるようにします。

### 完成イメージ
```
調査完了後のNotion画面:

📋 調査レポート データベース
┌─────────────────────────────────────┐
│ タイトル      │ 調査日時     │ ステータス │
├─────────────────────────────────────┤
│ グラボ おすすめ │ 2025/6/29   │ 完了      │
│ ChatGPT      │ 2025/6/28   │ 完了      │
│ 沖縄旅行      │ 2025/6/27   │ 完了      │
└─────────────────────────────────────┘

各タイトルをクリック → 詳細な調査レポートが表示
```

**所要時間**: 約15分

---

### 4.1 Notionワークスペースの準備

1. **Notionにアクセス**
   - [https://notion.so](https://notion.so)
   - アカウントを作成またはログイン

2. **新しいページを作成**
   - 左サイドバーの「+ 新規ページ」をクリック
   - ページタイトル: 「AI調査エージェント」と入力
   - Enterキーで確定

💡 **ヒント**: このページが AI調査エージェントの「本部」になります

### 4.2 データベースの作成（詳細手順）

#### **Step 4.2.1: データベースの作成**

1. **データベースを追加**
   - ページ内で「/database」と入力
   - 候補から「テーブル - インライン」を選択
   - 新しいデータベースが作成されます

2. **データベース名を変更**
   - デフォルトの「データベース」をクリック
   - 「調査レポート」に変更
   - Enterキーで確定

#### **Step 4.2.2: プロパティ（列）の設定**

**デフォルトで「名前」列が作成されているので、これを調整します**

1. **「名前」列を「タイトル」に変更**
   - 「名前」列のヘッダーをクリック
   - 「プロパティを編集」を選択
   - プロパティ名: 「タイトル」に変更
   - 「完了」をクリック

2. **「調査日時」列を追加**
   - 右端の「+」ボタンをクリック
   - プロパティ名: 「調査日時」
   - プロパティタイプ: 「リッチテキスト」を選択
   - 「完了」をクリック

3. **「ステータス」列を追加**
   - 再び「+」ボタンをクリック
   - プロパティ名: 「ステータス」
   - プロパティタイプ: 「セレクト」を選択
   - オプションを追加:
     - 「完了」（色: 緑）
     - 「進行中」（色: 黄）
   - 「完了」をクリック

✅ **確認**: 3つの列（タイトル・調査日時・ステータス）が表示されていればOK！

#### **Step 4.2.3: データベースIDの取得**

**このIDは後で n8n の設定で使用します**

1. **データベースのURLを確認**
   - データベースタイトル「調査レポート」の右にある「⋯」をクリック
   - 「リンクをコピー」を選択

2. **URLからIDを抽出**
   ```
   https://www.notion.so/【ここがデータベースID】?v=xxxxx
   ```
   
   **データベースID例**: `a1b2c3d4e5f6789012345678901234567890`

3. **IDをメモ帳に保存**
   ```text
   NotionデータベースID: a1b2c3d4e5f6789012345678901234567890
   ```

### 4.3 Notion API設定

#### **Step 4.3.1: インテグレーション（API接続）の作成**

1. **Notion Developers にアクセス**
   - [https://developers.notion.com/](https://developers.notion.com/)
   - 右上の「View my integrations」をクリック
   - Notionアカウントでログイン

2. **新しいインテグレーションを作成**
   - 「+ 新しいインテグレーション」をクリック
   - 基本情報を入力:
     - 名前: `AI Research Agent`
     - ワークスペース: あなたのワークスペースを選択
     - タイプ: 「内部」のまま
   - 「送信」をクリック

3. **内部秘密キーをコピー**
   - 作成後の画面で「内部秘密キー」をコピー
   
   ```
   Notion API キー例: secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```

⚠️ **重要**: この秘密キーは絶対に他人に見せないでください！

#### **Step 4.3.2: データベースにインテグレーションを接続**

**最重要ステップ**: この設定を忘れると、n8nがNotionにアクセスできません！

1. **データベースの共有設定**
   - Notionで「調査レポート」データベースに戻る
   - 右上の「共有」ボタンをクリック

2. **インテグレーションを追加**
   - 「招待」欄で作成したインテグレーション名を検索
   - 「AI Research Agent」を選択
   - 「招待」をクリック

✅ **確認方法**: 共有設定に「AI Research Agent」が表示されていればOK！

### 4.4 動作テスト（推奨）

**Notion APIが正しく設定されているかテストしましょう**

1. **テスト用ツールにアクセス**
   - [Notion API テスター](https://developers.notion.com/reference/post-database-query)（公式）
   - または後でn8nでテスト実行

2. **手動でテストデータを追加**
   - 「調査レポート」データベースに手動で1行追加
   - タイトル: 「テスト調査」
   - 調査日時: 「2025/6/29」
   - ステータス: 「完了」

💡 **このテストデータは後で削除できます**

### 4.5 Google Sheets の config 更新

**Step 2 で作成したスプレッドシートに Notion 情報を記録**

1. **config シートを開く**
   - 「AI調査エージェント状態管理」スプレッドシート
   - 「config」シートを選択

2. **Notion情報を入力**
   
   | key | value |
   |-----|-------|
   | notion_database_id | a1b2c3d4e5f6789012345678901234567890 |

💾 **保存**: 入力後、自動で保存されます

---

💾 **ここまでの成果物を確認**:
- ✅ Notionワークスペースに「AI調査エージェント」ページを作成
- ✅ 「調査レポート」データベースを作成（3列構成）
- ✅ データベースID（32文字程度）を取得
- ✅ Notion API インテグレーションを作成
- ✅ 内部秘密キー（secret_xxxxx形式）を取得
- ✅ データベースにインテグレーションを接続
- ✅ Google Sheets の config にデータベースIDを記録

**次のステップ**: これでレポート保存先の準備が整いました！次はn8nでワークフローを動かします ⚙️

---

## ⚙️ Step 5: n8nのセットアップ

### なぜn8nが必要なの？
n8nは「ワークフロー自動化プラットフォーム」で、AI調査エージェントの「頭脳」となる部分です。Discord、Google Sheets、Notion、Claude AIなどの各サービスを連携させ、15分間隔で調査を実行する仕組みを作ります。

### どちらの方法を選びますか？

以下の2つの方法があります。**初回は断然クラウド版がおすすめ**です！

#### 🌥️ **クラウド版（推奨・初心者向け）**
- **セットアップ**: 約5分
- **料金**: 14日間無料トライアル → その後€20/月〜
- **メリット**: 超簡単、常時稼働、メンテナンス不要
- **デメリット**: 無料期間終了後は有料

**月間使用量予測**: 調査ワークフロー約2,880回 + 学習ワークフロー4回 = **約2,884回**
→ **Starterプラン（€20/月、2,500実行）で運用可能** 💰

#### 🏠 **セルフホスト版（技術者向け）**  
- **セットアップ**: 約30-60分
- **料金**: 完全無料
- **メリット**: 制限なし、完全コントロール
- **デメリット**: Docker知識必要、24時間PC稼働、メンテナンス自己責任

**おすすめ**: まずクラウド版で14日間無料お試し→気に入ったらそのまま継続 or セルフホスト版に移行

---

## 🌥️ Step 5A: クラウド版のセットアップ（推奨）

**所要時間**: 約5分

### 5A.1 n8n Cloudアカウント作成

1. **n8n Cloudにアクセス**
   - [https://n8n.cloud](https://n8n.cloud)
   - 「Start free」をクリック

2. **アカウント作成**
   - メールアドレスとパスワードを入力
   - 「Create account」をクリック
   - メール認証を完了

3. **ワークスペース作成**
   - ワークスペース名: `AI-Research-Agent`（任意）
   - 「Create workspace」をクリック

✅ **確認**: n8nのダッシュボードが表示されればOK！

### 5A.2 認証情報の設定

**各サービスとの接続設定を行います**

1. **認証情報画面にアクセス**
   - 左メニューから「Credentials」をクリック
   - 右上の「Add credential」をクリック

2. **Discord Bot API の設定**
   ```
   Credential Type: Discord Bot API
   Bot Token: [Step 1で取得したトークン]
   ```
   - 「Save」をクリック

3. **Google Service Account の設定**
   ```
   Credential Type: Google Service Account
   Service Account Email: [Step 2のJSONファイル内のclient_email]
   Private Key: [Step 2のJSONファイル内のprivate_key]
   ```
   - 「Save」をクリック

4. **Anthropic API の設定**
   ```
   Credential Type: Anthropic API
   API Key: [Claude APIキー]
   ```
   - 「Save」をクリック

5. **Notion API の設定**
   ```
   Credential Type: Notion API
   API Key: [Step 4で取得した内部秘密キー]
   ```
   - 「Save」をクリック

✅ **確認**: 4つの認証情報が作成されていればOK！

---

## 🏠 Step 5B: セルフホスト版のセットアップ（上級者向け）

**所要時間**: 約30-60分  
**前提条件**: Docker の基本知識、Linux/Terminal 操作経験

⚠️ **注意**: この方法は技術的な知識が必要です。初心者の方は 5A（クラウド版）を強く推奨します。

### 5B.1 Docker環境の準備

#### **Windows/Mac の場合**

1. **Docker Desktop のインストール**
   - [Docker Desktop](https://www.docker.com/products/docker-desktop)をダウンロード
   - インストール後、再起動

2. **動作確認**
   ```bash
   docker --version
   # Docker version 20.10.x が表示されればOK
   ```

#### **Linux (Ubuntu) の場合**

1. **Docker のインストール**
   ```bash
   # パッケージの更新
   sudo apt update
   
   # Dockerのインストール
   sudo apt install docker.io
   
   # 自動起動の設定
   sudo systemctl enable docker
   sudo systemctl start docker
   
   # ユーザーをdockerグループに追加
   sudo usermod -aG docker $USER
   ```

2. **ログアウト→ログイン**
   - 権限変更を反映するため

3. **動作確認**
   ```bash
   docker --version
   # sudoなしで実行できればOK
   ```

### 5B.2 n8n コンテナの起動

1. **データ保存用ディレクトリ作成**
   ```bash
   # ホームディレクトリにn8n用フォルダを作成
   mkdir -p ~/.n8n
   ```

2. **n8n コンテナ起動（永続化対応）**
   ```bash
   docker run -d \
     --name n8n \
     --restart unless-stopped \
     -p 5678:5678 \
     -v ~/.n8n:/home/node/.n8n \
     n8nio/n8n
   ```

3. **起動確認**
   ```bash
   # コンテナ状況確認
   docker ps
   
   # n8nが "Up" 状態で表示されればOK
   ```

4. **n8nにアクセス**
   - ブラウザで `http://localhost:5678` にアクセス
   - 初期ユーザーを作成

### 5B.3 認証情報の設定

**クラウド版と同じ手順で認証情報を設定**

1. **認証情報画面**: 左メニュー「Credentials」
2. **Discord Bot API**: Step 1のトークン
3. **Google Service Account**: Step 2のJSONファイル内容
4. **Anthropic API**: Claude APIキー  
5. **Notion API**: Step 4の内部秘密キー

### 5B.4 24時間稼働の設定

**重要**: AIエージェントを24時間動作させるための設定

#### **Windows の場合**
1. **電源設定の変更**
   - 「設定」→「システム」→「電源とスリープ」
   - 「スリープ」を「なし」に設定

2. **Docker Desktop の自動起動**
   - Docker Desktop 設定で「Start Docker Desktop when you log in」を有効

#### **Mac の場合**
1. **省エネルギー設定**
   - 「システム環境設定」→「省エネルギー」
   - 「コンピュータのスリープを防ぐ」を有効

#### **Linux の場合**
1. **systemd サービス化（推奨）**
   ```bash
   # サービスファイル作成
   sudo nano /etc/systemd/system/n8n.service
   ```
   
   ```ini
   [Unit]
   Description=n8n workflow automation
   After=docker.service
   
   [Service]
   Type=forking
   ExecStart=/usr/bin/docker start n8n
   ExecStop=/usr/bin/docker stop n8n
   Restart=always
   
   [Install]
   WantedBy=multi-user.target
   ```
   
   ```bash
   # サービス有効化
   sudo systemctl enable n8n.service
   sudo systemctl start n8n.service
   ```

### 5B.5 保守・メンテナンス

#### **定期メンテナンス（月1回推奨）**
```bash
# コンテナ状況確認
docker ps -a

# ログ確認
docker logs n8n

# n8n更新（必要に応じて）
docker pull n8nio/n8n
docker stop n8n
docker rm n8n
# 5B.2の起動コマンドを再実行
```

#### **トラブル時の対処**
```bash
# コンテナ再起動
docker restart n8n

# 完全リセット
docker stop n8n
docker rm n8n
# データは ~/.n8n に保存されているので安全
```

---

💾 **ここまでの成果物を確認**:

### 🌥️ **クラウド版完了の場合**
- ✅ n8n Cloud アカウント作成
- ✅ 4つの認証情報設定完了
- ✅ ダッシュボードにアクセス可能

### 🏠 **セルフホスト版完了の場合**  
- ✅ Docker 環境構築
- ✅ n8n コンテナ起動（localhost:5678）
- ✅ 4つの認証情報設定完了
- ✅ 24時間稼働設定完了

**次のステップ**: いよいよワークフローをインポートして、AI調査エージェントを動かします！ 🚀

---

## 🚀 Step 6: ワークフローのインポート

### なぜワークフローファイルが必要なの？
ワークフローファイルは、AI調査エージェントの「設計図」です。Discord監視、Web検索、AI分析、Notion保存などの複雑な処理を、事前に組み立てられたワークフローとして一気にインポートできます。

### 完成イメージ
```
インポート前: 空のn8n画面
        ↓
ワークフローインポート
        ↓
インポート後: 完全に設定された自動化システム
・調査ワークフロー（メイン処理）
・学習ワークフロー（週次自己改良）
```

**所要時間**: 約10分

---

### 6.1 ワークフローファイルの取得

#### **Step 6.1.1: GitHubリポジトリからダウンロード**

1. **GitHubリポジトリにアクセス**
   - [https://github.com/y-n-dev/AI-Research-Agent](https://github.com/y-n-dev/AI-Research-Agent)
   - ブラウザで上記URLを開く

2. **リポジトリ全体をダウンロード**
   - 緑色の「**< > Code**」ボタンをクリック
   - 「**Download ZIP**」を選択
   - ZIPファイルがダウンロードされます

3. **ZIPファイルを展開**
   - ダウンロードした「AI-Research-Agent-main.zip」を解凍
   - デスクトップや分かりやすい場所に展開

#### **Step 6.1.2: 必要なファイルを確認**

展開したフォルダ内で以下のファイルを確認：

```
AI-Research-Agent-main/
├── workflows/
│   ├── research_workflow_jp.json    ← 日本語版調査ワークフロー
│   ├── research_workflow_en.json    ← 英語版調査ワークフロー
│   ├── learning_workflow_jp.json    ← 日本語版学習ワークフロー
│   └── learning_workflow_en.json    ← 英語版学習ワークフロー
└── docs/
    └── (その他のドキュメント)
```

💡 **どれを使う？**: 日本語でセットアップしている場合は `_jp.json` ファイルを使用

### 6.2 n8nでのワークフローインポート

#### **Step 6.2.1: 調査ワークフロー（メイン処理）のインポート**

1. **n8nにログイン**
   - **クラウド版**: n8n.cloud のダッシュボード
   - **セルフホスト版**: http://localhost:5678

2. **新しいワークフローを作成**
   - 「**+ Add workflow**」または「**Create workflow**」をクリック
   - 空のワークフロー画面が表示されます

3. **ワークフローをインポート**
   - 右上の「**...**」（3点メニュー）をクリック
   - 「**Import from file**」を選択
   - `research_workflow_jp.json` を選択
   - 「開く」をクリック

4. **インポート確認**
   - 多数のノード（ボックス）が接続された複雑なワークフローが表示されます
   - 「Schedule Trigger」「Discord」「Google Sheets」「Claude」「Notion」などのノードが確認できればOK

#### **Step 6.2.2: 学習ワークフロー（週次自己改良）のインポート**

1. **新しいワークフローを作成**
   - 再び「**+ Add workflow**」をクリック

2. **学習ワークフローをインポート**
   - 同様に「**...**」→「**Import from file**」
   - `learning_workflow_jp.json` を選択
   - インポート実行

3. **インポート確認**
   - 「Schedule Trigger」「Google Sheets」「Claude」「Discord」などが週次学習用に配置されていることを確認

✅ **確認**: 2つのワークフローがn8nのワークフロー一覧に表示されていればOK！

### 6.3 認証情報の紐付け（重要！）

**インポートしただけでは動作しません。各ノードにStep 5で作成した認証情報を設定する必要があります**

#### **Step 6.3.1: 調査ワークフローの認証設定**

1. **調査ワークフローを開く**
   - ワークフロー一覧から「research_workflow_jp」をクリック

2. **各ノードの認証情報を設定**

   **Discord ノード**:
   - Discord関連のノード（複数個所）をクリック
   - 「Credential to connect with」で Step 5で作成した「Discord Bot API」を選択

   **Google Sheets ノード**:
   - Google Sheets関連のノード（複数個所）をクリック
   - 「Credential to connect with」で「Google Service Account」を選択

   **Anthropic Chat Model ノード**:
   - 「Anthropic Chat Model」ノードをクリック
   - 「Credential to connect with」で「Anthropic API」を選択

   **Notion ノード**:
   - Notion関連のノードをクリック
   - 「Credential to connect with」で「Notion API」を選択

3. **設定を保存**
   - 「**Save**」ボタンをクリック

#### **Step 6.3.2: 学習ワークフローの認証設定**

**同様の手順で学習ワークフローの認証情報も設定**

1. **学習ワークフローを開く**
   - 「learning_workflow_jp」をクリック

2. **各ノードの認証情報を設定**
   - Google Sheets ノード → 「Google Service Account」
   - Anthropic Chat Model ノード → 「Anthropic API」  
   - Discord ノード → 「Discord Bot API」

3. **設定を保存**

### 6.4 スプレッドシートIDの設定（最重要！）

**n8nがGoogle Sheetsにアクセスできるように、Step 2で取得したスプレッドシートIDを設定**

#### **Step 6.4.1: 調査ワークフローのシート設定**

1. **Google Sheetsノードを確認**
   - 調査ワークフローで「Google Sheets」と名前の付いたノードを順次クリック

2. **Document IDを設定**
   ```
   Document ID: 1tE6eK5zy48iBCCxu9bW0depV49eIuWu5-DLfHZsM2Os
   ```
   - Step 2で取得したスプレッドシートIDを入力

3. **Sheet Nameを設定**
   - 「Sheet Name」で適切なシート名を選択：
     - `config` → 基本設定
     - `processed_messages` → 処理済みメッセージ
     - `research_history` → 調査履歴
     - `prompt_management` → プロンプト管理

💡 **ヒント**: 各ノードで正しいシート名が選択されているか確認

#### **Step 6.4.2: 学習ワークフローのシート設定**

**同様に学習ワークフローのGoogle Sheetsノードも設定**

### 6.5 NotionデータベースIDの設定

1. **Notionノードを確認**
   - 調査ワークフローの「Notion」ノードをクリック

2. **Database IDを設定**
   ```
   Database ID: a1b2c3d4e5f6789012345678901234567890
   ```
   - Step 4で取得したNotionデータベースIDを入力

### 6.6 動作テストの準備

**ワークフローを有効化する前に、Step 7で設定値を完了させる必要があります**

⚠️ **重要**: まだワークフローを「Active」にしないでください！
→ Step 7でDiscord IDなどを設定してから有効化します

---

💾 **ここまでの成果物を確認**:
- ✅ GitHubからワークフローファイルを取得
- ✅ 2つのワークフロー（調査・学習）をn8nにインポート
- ✅ 全ノードの認証情報を設定
- ✅ スプレッドシートIDを全Google Sheetsノードに設定
- ✅ NotionデータベースIDを設定

**次のステップ**: Step 7でDiscord IDや各種設定値を入力して、いよいよシステムを動かします！ 🎯

---

## 🎯 Step 7: 設定値の入力

### なぜ設定値の入力が必要なの？
これまで作成したDiscord Bot、Google Sheets、Notionなどの「住所」をAI調査エージェントに教える作業です。正しいIDを設定することで、各サービス間の連携が可能になります。

### 完成イメージ
```
設定前: 各サービスがバラバラに存在
        ↓
設定値入力: IDで各サービスを紐付け
        ↓  
設定後: 完全に連携されたAI調査システム
```

**所要時間**: 約15分

---

### 7.1 DiscordのIDを取得

#### **Step 7.1.1: Discord開発者モードの有効化**

**開発者モードとは？**: DiscordでサーバーやチャンネルのIDを表示できるようにする機能です

1. **Discordを開く**
   - デスクトップアプリまたはブラウザ版Discord

2. **設定画面を開く**
   - 画面下の自分のユーザー名の隣にある「**⚙️歯車**」アイコンをクリック

3. **開発者モードを有効化**
   - 左メニューから「**詳細設定**」をクリック
   - 「**開発者モード**」のスイッチを**ON**にする
   - 設定画面を閉じる（×ボタンまたはEscキー）

✅ **確認方法**: サーバー名やチャンネル名を右クリックして「IDをコピー」が表示されればOK！

#### **Step 7.1.2: サーバーIDの取得**

1. **サーバー名を右クリック**
   - AI調査エージェントを設置したサーバー名を右クリック
   - 「**IDをコピー**」を選択

2. **IDをメモ**
   ```
   Discord サーバーID例: 123456789012345678
   ```
   - 18-19桁の数字がコピーされます
   - メモ帳に「サーバーID: 123456789012345678」として保存

#### **Step 7.1.3: チャンネルIDの取得**

**推奨チャンネル構成**（Step 1で作成したチャンネル）:
- 📝 `ai調査依頼` - 調査したいトピックを投稿
- 📋 `調査結果` - 開始・完了通知  
- 💭 `aiちゃんのつぶやき` - 退屈メッセージ・学習報告

**各チャンネルのIDを取得**:

1. **調査依頼チャンネルID**
   - `ai調査依頼` チャンネル名を右クリック
   - 「IDをコピー」→ メモ帳に保存
   
   ```
   調査依頼チャンネルID例: 987654321098765432
   ```

2. **調査結果チャンネルID**
   - `調査結果` チャンネル名を右クリック
   - 「IDをコピー」→ メモ帳に保存

3. **つぶやきチャンネルID**
   - `aiちゃんのつぶやき` チャンネル名を右クリック
   - 「IDをコピー」→ メモ帳に保存

💡 **ヒント**: チャンネル名は例なので、実際に作成したチャンネル名で操作してください

#### **Step 7.1.4: 取得したIDの整理**

**メモ帳に以下の形でまとめておきましょう**:
```text
=== Discord ID一覧 ===
サーバーID: 123456789012345678
調査依頼チャンネルID: 987654321098765432  
調査結果チャンネルID: 456789012345678901
つぶやきチャンネルID: 789012345678901234
```

### 7.2 Google Sheetsのconfigシートを更新

#### **Step 7.2.1: スプレッドシートを開く**

1. **Google Sheetsにアクセス**
   - [https://sheets.google.com](https://sheets.google.com)
   - Step 2で作成した「AI調査エージェント状態管理」を開く

2. **configシートを選択**
   - 画面下部の「config」タブをクリック

#### **Step 7.2.2: 設定値を入力**

**以下のkey列に対応するvalue列に、取得したIDやAPIキーを入力**:

| key | value | 取得元 |
|-----|-------|--------|
| discord_server_id | 123456789012345678 | Step 7.1.2で取得 |
| discord_research_channel_id | 987654321098765432 | Step 7.1.3で取得（調査依頼） |
| discord_result_channel_id | 456789012345678901 | Step 7.1.3で取得（調査結果） |
| discord_chat_channel_id | 789012345678901234 | Step 7.1.3で取得（つぶやき） |
| google_search_api_key | AIzaSyDxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx | Step 3で取得 |
| google_search_engine_id | a1b2c3d4e5f6g7h8i9j0 | Step 3で取得 |
| notion_database_id | a1b2c3d4e5f6789012345678901234567890 | Step 4で取得 |
| last_message_id | （空欄のまま） | 自動管理 |
| boredom_level | 0 | 初期値 |
| learning_count | 0 | 初期値 |

💾 **保存**: 入力後、自動で保存されます

#### **Step 7.2.3: 入力確認**

**すべての値が正しく入力されているか確認**:
- ✅ Discord IDは18-19桁の数字
- ✅ Google APIキーは「AIzaSy」で始まる
- ✅ 検索エンジンIDは英数字の組み合わせ
- ✅ NotionデータベースIDは32文字程度の英数字

### 7.3 初期プロンプトの設定

#### **Step 7.3.1: prompt_managementシートを開く**

1. **prompt_managementシートに移動**
   - 画面下部の「prompt_management」タブをクリック

2. **初期プロンプト情報を入力**

**以下の内容を1行目（ヘッダーの下）に入力**:

| A列 | B列 | C列 | D列 | E列 | F列 | G列 |
|-----|-----|-----|-----|-----|-----|-----|
| prompt_name | current_prompt_text | version | update_date | improvement_reason | is_active | character_limit |
| 調査用メイン_v1.0 | あなたは調査エージェントAIです。🎯 **調査方針** 調査対象の種類に応じて最適な観点で分析し、実用的な情報を提供してください。📊 **重要な観点** - 基本情報と概要 - 特徴やメリット・デメリット - 価格や費用（該当する場合） - 利用方法やアクセス方法 - 注意点や推奨事項 Web検索結果を参考にして、読みやすく実用的な調査レポートを作成してください。 | v1.0 | 2025/6/29 | 初期設定 | TRUE | 1800 |

💡 **コピペ用プロンプト**:
```
あなたは調査エージェントAIです。🎯 **調査方針** 調査対象の種類に応じて最適な観点で分析し、実用的な情報を提供してください。📊 **重要な観点** - 基本情報と概要 - 特徴やメリット・デメリット - 価格や費用（該当する場合） - 利用方法やアクセス方法 - 注意点や推奨事項 Web検索結果を参考にして、読みやすく実用的な調査レポートを作成してください。
```

### 7.4 設定完了の最終確認

#### **Step 7.4.1: 各シートの確認**

**configシート**:
- ✅ 10個のkey-valueペアがすべて入力されている
- ✅ Discord IDは数字のみ（ダブルクォーテーションなし）
- ✅ APIキーに余計な文字が入っていない

**prompt_managementシート**:
- ✅ 初期プロンプトが1行目に入力されている
- ✅ is_activeが「TRUE」になっている
- ✅ character_limitが「1800」になっている

#### **Step 7.4.2: ID形式の再確認**

**よくある間違いとその修正**:

❌ **間違い例**:
```
discord_server_id: "123456789012345678"  ← ダブルクォーテーション不要
google_search_api_key: AIzaSy...xxx...   ← コピペ漏れ
```

✅ **正しい例**:
```
discord_server_id: 123456789012345678
google_search_api_key: AIzaSyDxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

💾 **ここまでの成果物を確認**:
- ✅ Discord開発者モードを有効化
- ✅ サーバーID・3つのチャンネルIDを取得
- ✅ Google Sheetsのconfigシートに全設定値を入力
- ✅ 初期プロンプトをprompt_managementシートに設定
- ✅ 設定値の形式・内容を確認

**次のステップ**: いよいよワークフローを有効化して、AI調査エージェントの動作テストを行います！ ✅

---

## ✅ Step 8: 動作テスト

### ついに動かす時が来ました！
これまでの設定がすべて正しく動作するかテストします。初回動作の「おぉー！」という感動をお楽しみください！

### 完成イメージ
```
テスト投稿「iPhone 15」
        ↓
【最大15分待機】
        ↓
🤖「📝 iPhone 15の調査を開始します！」
        ↓
【Web検索 + AI分析】
        ↓
🤖「✅ 調査完了！結果をNotionに保存しました [リンク]」
        ↓
Notionで詳細レポート確認
```

**所要時間**: 約20分（待機時間含む）

---

### 8.1 ワークフローの有効化

#### **Step 8.1.1: 調査ワークフローを有効化**

1. **n8nにアクセス**
   - **クラウド版**: n8n.cloud のダッシュボード
   - **セルフホスト版**: http://localhost:5678

2. **調査ワークフローを開く**
   - ワークフロー一覧から「research_workflow_jp」をクリック

3. **ワークフローを有効化**
   - 画面右上の「**Inactive**」ボタンをクリック
   - 「**Active**」に変更される
   - 緑色の「Active」表示になればOK

#### **Step 8.1.2: 学習ワークフローを有効化**

1. **学習ワークフローを開く**
   - ワークフロー一覧から「learning_workflow_jp」をクリック

2. **ワークフローを有効化**
   - 同様に「Inactive」→「Active」に変更

✅ **確認**: 2つのワークフローが両方とも「Active」状態になっていればOK！

### 8.2 初回テスト実行

#### **Step 8.2.1: テスト調査を投稿**

1. **Discord調査チャンネルにアクセス**
   - Step 1で作成した調査依頼チャンネル（例：`ai調査依頼`）を開く

2. **テスト投稿を作成**
   ```
   iPhone 15
   ```
   - シンプルで分かりやすいトピックでテスト
   - Enterキーで投稿

3. **Bot反応の確認**
   - この時点では**まだ反応しません**（正常です）
   - 次の15分間隔で処理されるまで待機

💡 **なぜすぐ反応しないの？**: 15分間隔のスケジュール実行のため、最大15分の待機が必要です

#### **Step 8.2.2: 待機中の確認事項**

**1. ワークフロー実行ログの確認**

1. **n8nでワークフロー実行を確認**
   - 調査ワークフローの画面で「Executions」タブをクリック
   - 15分以内に新しい実行ログが表示されるはず

2. **実行状況を監視**
   - ✅ **成功**: 緑色のチェックマーク
   - ❌ **エラー**: 赤色のエラーマーク
   - 🟡 **実行中**: 黄色の実行中マーク

**2. Google Sheetsの状況確認**

- **configシート**: `last_message_id` や `boredom_level` の値が変更される
- **processed_messagesシート**: テスト投稿のメッセージが記録される

#### **Step 8.2.3: 成功パターンの確認**

**15分以内に以下の順序で通知が届きます**:

1. **調査開始通知**（調査結果チャンネル）
   ```
   📝 「iPhone 15」の調査を開始します！
   
   👤 依頼者: あなたのユーザー名
   🔗 元メッセージ: [リンク]
   
   調査完了までお待ちください〜✨
   ```

2. **数分後: 調査完了通知**（調査結果チャンネル）
   ```
   ✅ 「iPhone 15」の調査が完了しました！
   
   📋 結果はNotionに保存されました
   🔗 調査レポート: [Notionページリンク]
   お疲れ様でした〜✨
   ```

3. **Notionページの作成**
   - Step 4で作成した「調査レポート」データベースに新しいページが追加
   - タイトル: 「iPhone 15」
   - 本文: 詳細な調査レポート

✅ **テスト成功の判定**: 上記3つがすべて確認できればOK！

### 8.3 エラー対処法

#### **Step 8.3.1: よくあるエラーパターン**

**❌ エラー1: 認証エラー**
```
401 Unauthorized / 403 Forbidden
```
**原因**: API認証情報の設定ミス
**対処法**:
- Step 5の認証情報設定を再確認
- Google Service AccountのJSONファイル内容を確認
- スプレッドシートの共有設定を確認

**❌ エラー2: ID間違い**
```
Invalid Value / Not Found
```
**原因**: Discord ID、スプレッドシートID、NotionデータベースIDの間違い
**対処法**:
- Step 7の設定値を再確認
- IDにダブルクォーテーションが入っていないか確認
- コピペミスがないか確認

**❌ エラー3: DNS解決エラー（セルフホスト版）**
```
getaddrinfo EAI_AGAIN
```
**原因**: Docker環境の問題
**対処法**:
```bash
# Docker環境の再起動
sudo systemctl restart docker
docker restart n8n
```

#### **Step 8.3.2: エラー詳細の確認方法**

1. **n8nエラーログの確認**
   - ワークフローの「Executions」タブ
   - 失敗した実行をクリック
   - エラーメッセージを確認

2. **段階的なテスト**
   - 問題のあるノードを個別実行
   - 「Test step」ボタンで単体テスト
   - エラーの原因を特定

### 8.4 追加テスト（推奨）

#### **Step 8.4.1: 複数調査のテスト**

**異なるトピックで複数テストしてみましょう**:

1. **1つ目**: 「ChatGPT」
2. **2つ目**: 「Nintendo Switch」  
3. **3つ目**: 「沖縄旅行」

**期待される動作**:
- 古い順から確実に処理される
- 各調査でNotionに個別ページが作成される
- 重複処理が発生しない

#### **Step 8.4.2: 退屈レベルテスト**

**調査依頼を停止して退屈メッセージをテスト**:

1. **96回実行後（24時間後）**: 「💤 お疲れ様です〜...」
2. **288回実行後（72時間後）**: 「🥺 ちょっと退屈してます...」
3. **576回実行後（1週間後）**: 「🤖💭 そろそろ新しい商品について...」

💡 **時間短縮テスト**: configシートの`boredom_level`を手動で95に変更すると、次回実行で24時間メッセージをテスト可能

### 8.5 学習ワークフローのテスト

#### **Step 8.5.1: 手動学習実行**

**週次学習を手動でテストしてみましょう**:

1. **学習ワークフローを開く**
   - 「learning_workflow_jp」をクリック

2. **手動実行**
   - 「Test workflow」ボタンをクリック
   - 学習分析が実行される

3. **学習結果の確認**
   - つぶやきチャンネルに学習レポートが投稿される
   - prompt_managementシートに新しいバージョンが追加される可能性

---

💾 **テスト完了の確認項目**:
- ✅ 調査開始通知がDiscordに投稿される
- ✅ 調査完了通知がDiscordに投稿される  
- ✅ Notionに調査レポートページが作成される
- ✅ Google Sheetsのprocessed_messagesに記録される
- ✅ 複数調査が古い順から処理される
- ✅ エラーなく安定して動作する

**次のステップ**: テスト成功後は、いよいよ本格運用開始です！Step 9でカスタマイズ方法をご紹介します 🎊

---

## 🎊 Step 9: カスタマイズ

### 9.1 調査プロンプトの調整

`prompt_management`シートの`current_prompt_text`を編集して、調査スタイルをカスタマイズできます。

### 9.2 実行間隔の変更

デフォルトは15分間隔ですが、n8nの「Schedule Trigger」で変更可能：
- 5分間隔: より早い応答
- 30分間隔: APIコスト削減

### 9.3 文字数制限の調整

`prompt_management`シートの`character_limit`で調整：
- 1800文字: 簡潔なレポート
- 3000文字: 詳細なレポート

---

## 📞 サポート・トラブル時

### よくある問題
- **認証エラー**: Service Account設定を確認
- **DNS解決エラー**: Docker環境の再起動
- **API制限**: 使用量の確認

### サポートリソース
- [トラブルシューティング](troubleshooting.md)
- [GitHub Issues](https://github.com/y-n-dev/AI-Research-Agent/issues)
- Email: y.n.auto.dev@gmail.com

---

## 🎯 次のステップ

セットアップ完了おめでとうございます！🎉

### 運用開始
1. **日常利用**: Discordに調査したいトピックを投稿
2. **結果確認**: Notionで詳細レポートを確認
3. **成長確認**: 週1回のAI学習レポートを楽しむ

### さらなるカスタマイズ
- [プロンプトカスタマイズガイド](prompt-customization.md)
- [パフォーマンス最適化](performance-tuning.md)
- [バックアップ・復旧](backup-recovery.md)

---

**🤖 AI調査エージェントへようこそ！一緒に成長していきましょう〜✨**

*何か分からないことがあれば、遠慮なくお声がけください！*
